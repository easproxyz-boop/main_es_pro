<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Getstarted - Profile</title>

  <!-- ===========================
       STYLESHEETS
  ============================ -->
  <link rel="shortcut icon" href="assets/images/logo/provincial-capitol-logo.png" type="image/x-icon">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables Bootstrap 5 CSS -->
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">

  <!-- Remix Icon CSS -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- iziToast CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css" />

  <!-- Animate.css for animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Toastr CSS (Optional alternative to iziToast) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

  <!-- ===========================
       JAVASCRIPTS
  ============================ -->

  <!-- jQuery (must be loaded first) -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- DataTables Core -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <!-- DataTables Bootstrap 5 integration -->
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- iziToast JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>

  <!-- Toastr JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

  <!-- Lottie Animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.1/lottie.min.js"></script>



  <!-- CUSTOMIZE -->
  <!-- Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <script src="../js/app_api/app_api_endpoint.js" defer></script>
  <script src="../js/main/googleAuthAccess/googleAuthAccess.js" defer></script>
</head>
<body>

  <nav class="sticky-top bg-dark border border-bottom border-1 p-3">
    <a id="revokeBtn" class="btn btn-danger btn-sm">
      <i class="ri-arrow-left-fill"></i>
      Back to sign-in
    </a>
  </nav>




  <main class="py-5 container">

  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <!-- STEP 1 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-primary px-3 py-2">1</span>
        <div class="small fw-semibold mt-1">Token</div>
      </div>
      <div class="flex-fill border-top border-2 border-primary mx-1"></div>
      <!-- STEP 2 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-primary px-3 py-2">2</span>
        <div class="small fw-semibold mt-1">Provide Profile Details</div>
      </div>
      <div class="flex-fill border-top border-2 border-dark mx-1"></div>
      <!-- STEP 3 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-secondary px-3 py-2">3</span>
        <div class="small text-muted mt-1">Completed</div>
      </div>
    </div>
  </div>

    <div class="card mt-5">
        <div class="card-header">
            <h3 class="fs-3">Profile Information</h3>
        </div>
        <div class="card-body">

            <form id="profileForm">

              <!-- GOOGLE USER CARD -->
              <div class="bg-dark bg-opacity-10 mb-4 border-0 google-card">
                <div class="card-body d-flex align-items-center gap-3">
                  <img class="user-picture google-avatar rounded-circle border border-2" src="/default-avatar.png" alt="Google Profile">
                  <div class="flex-grow-1">
                    <div class="fw-bold user-name fs-6 text-dark">Guest User</div>
                    <div class="text-muted small user-email">email@gmail.com</div>
                    <div class="badge bg-light text-secondary mt-1 user-id">Google ID</div>
                  </div>
                  <div class="text-end">
                    <i class="ri-google-fill text-danger fs-3"></i>
                  </div>
                </div>
              </div>

              <hr>

              

              <h6 class="text-center bg-secondary text-white p-2">Profile Details</h6>

              <!-- PERSONAL INFO -->
              <div class="border border-dark border-1 p-3 mb-1">
              <p class="section-label">I. FULLNAME</p>
              <div class="row g-3 mb-4">
                <div class="col-md-3">
                  <label class="form-label">First Name <small class="text-danger">Required.</small></label>
                  <input type="text" name="pd_firstname" id="pd_firstname" class="form-control fw-bold text-uppercase" placeholder="ENTER FIRST NAME" requiredxxxx>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Middle Name <small class="text-danger">Required.</small></label>
                  <input type="text" name="pd_middlename" id="pd_middlename" class="form-control fw-bold text-uppercase" placeholder="ENTER MIDDLE NAME" requiredxxxx>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Last Name <small class="text-danger">Required.</small></label>
                  <input type="text" name="pd_lastname" id="pd_lastname" class="form-control fw-bold text-uppercase" placeholder="ENTER LAST NAME" requiredxxxx>
                </div>
                <div class="col-md-3">
                <label class="form-label">Suffix <small class="text-danger">Required.</small></label>
                <div class="input-group">
                    <select name="pd_suffix" id="pd_suffix" class="form-select fw-bold text-uppercase" requiredxxxx>
                    <option value="" selected disabled>Select Suffix</option>
                    <option value="N/A">N/A</option>
                    <option value="JR.">JR.</option>
                    <option value="SR.">SR.</option>
                    <option value="II">II</option>
                    <option value="III">III</option>
                    <option value="IV">IV</option>
                    <option value="V">V</option>
                    </select>
                    <div class="input-group-text">
                    <input class="form-check-input mt-0" type="checkbox" id="na_suffix">
                    <label class="form-check-label ms-1 mb-0" for="na_suffix">N/A</label>
                    </div>
                </div>
              </div>
              </div>
              </div>

              <!-- DATE OF BIRTH -->
              <div class="border border-dark border-1 p-3 mb-1">
              <p class="section-label">II. DATE OF BIRTH</p>
              <div class="row g-3 mb-4">
                <div class="col-md-4">
                  <label class="form-label">Year <small class="text-danger">Required.</small></label>
                  <select id="pd_birth_year" name="pd_birth_year" class="form-select fw-bold text-uppercase" requiredxxxx>
                    <option value="" disabled selected>Year</option>
                    <option value="N/A">N/A</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Month <small class="text-danger">Required.</small></label>
                  <select id="pd_birth_month" name="pd_birth_month" class="form-select fw-bold text-uppercase" requiredxxxx>
                    <option value="" disabled selected>Month</option>
                    <option value="N/A">N/A</option>
                    <option value="1">[1] JANUARY</option>
                    <option value="2">[2] FEBRUARY</option>
                    <option value="3">[3] MARCH</option>
                    <option value="4">[4] APRIL</option>
                    <option value="5">[5] MAY</option>
                    <option value="6">[6] JUNE</option>
                    <option value="7">[7] JULY</option>
                    <option value="8">[8] AUGUST</option>
                    <option value="9">[9] SEPTEMBER</option>
                    <option value="10">[10] OCTOBER</option>
                    <option value="11">[11] NOVEMBER</option>
                    <option value="12">[12] DECEMBER</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Day <small class="text-danger">Required.</small></label>
                  <select id="pd_birth_day" name="pd_birth_day" class="form-select fw-bold text-uppercase" requiredxxxx>
                    <option value="" disabled selected>Day</option>
                    <option value="N/A">N/A</option>
                  </select>
                </div>
              </div>
              </div>

  
            <!-- GENDER AND CONTACT NO -->
            <div class="border border-dark border-1 p-3 mb-1">

            <p class="section-label">III. GENDER AND CONTACT INFORMATION</p>
            <div class="row g-3 mb-4">

            <!-- Gender -->
            <div class="col-md-6">
                <label class="form-label">Gender <small class="text-danger">Required.</small></label>
                <select id="pd_gender" name="pd_gender" class="form-select fw-bold text-uppercase" requiredxxxx>
                    <option value="" disabled selected>-- SELECT --</option>
                    <option value="MALE">MALE</option>
                    <option value="FEMALE">FEMALE</option>
                </select>
            </div>

            <!-- Contact Number -->
            <div class="col-md-6">
                <label for="pd_contact_no" class="form-label">Contact Number <small class="text-danger">Required.</small></label>
                <div class="input-group">
                    <input type="text" 
                            id="pd_contact_no" 
                            name="pd_contact_no" 
                            class="form-control fw-bold text-uppercase" 
                            placeholder="E.G., 0900-000-0000" 
                            title="Format: 0900-000-0000" 
                            requiredxxxx>
                    <div class="input-group-text">
                        <input class="form-check-input mt-0" type="checkbox" id="na_contact">
                        <label class="form-check-label ms-1 mb-0" for="na_contact">N/A</label>
                    </div>
                </div>
            </div>

            </div>
            </div>







              <!-- ADDRESS -->
              <div class="border border-dark border-1 p-3 mb-1">

              <p class="section-label">IV. ADDRESS INFORMATION</p>
              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <label class="form-label">Town / Municipality <small class="text-danger">Required.</small></label>
                  <select id="pd_address_town" name="pd_address_town" class="form-select fw-bold text-uppercase">
                    <option value="">Select Town</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Barangay <small class="text-danger">Required.</small></label>
                  <select id="pd_address_brgy" name="pd_address_brgy" class="form-select fw-bold text-uppercase" disabled>
                    <option value="">Select Barangay</option>
                  </select>
                </div>
              </div>
              </div>

              <hr>

              <h6 class="text-center bg-secondary text-white p-2">Work Details</h6>


            <div class="border border-dark border-1 p-3 mb-3">
            <p class="section-label mb-1">I. OFFICE INFORMATION</p>

                <!-- Containers for dynamic office content -->
                <div class="row g-3 mb-3">
                    <div class="col-12">
                        <label class="form-label">Office / Department <small class="text-danger">Required.</small></label>
                        <select id="pd_office_department_name" name="pd_office_department_name" class="form-select fw-bold text-uppercase">
                          <option value="">Select Department</option>
                          <option value="N/A">N/A</option>

                        </select>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <label class="form-label">Eligibility <small class="text-danger">Required.</small></label>
                        <input type="text" id="pd_eligibility" name="pd_eligibility" class="form-control fw-bold text-uppercase" placeholder="E.G., REGISTER SOCIAL WORKER" requiredxxxx>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Position <small class="text-danger">Required.</small></label>
                        <input type="text" id="pd_position_rank" name="pd_position_rank" class="form-control fw-bold text-uppercase" placeholder="E.G., SOCIAL WORKER, ETC." requiredxxxx>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Position (acronym) <small class="text-danger">Required.</small></label>
                        <input type="text" id="pd_position_rank_acronym" name="pd_position_rank_acronym" class="form-control fw-bold text-uppercase" placeholder="E.G., SW, ETC." requiredxxxx>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Position status <small class="text-danger">Required.</small></label>
                        <select id="pd_position_status" name="pd_position_status" class="form-select fw-bold text-uppercase" requiredxxxx>
                            <option value="" disabled selected>-- SELECT --</option>
                            <option value="PERMANENT">PERMANENT</option>
                            <option value="JOB ORDER">JOB ORDER</option>
                        </select>
                    </div>
                </div>


            </div>






              
              <hr>


              <div class="d-flex justify-content-end gap-2 mb-3">
                <button type="reset" class="btn btn-outline-secondary px-4">Clear</button>
                <button type="submit" id="btn-getstarted-2-profile" class="btn btn-primary px-5">Save Profile</button>
              </div>

            </form>





        </div>
    </div>
  </main>





<!-- SUBMIT -->


<script>
$(document).ready(function () {

  $('#profileForm').on('submit', function (e) {
    e.preventDefault();

    const $btn = $('#btn-getstarted-2-profile');
    $btn.prop('disabled', true).text('Saving...');

    $.ajax({
      url: `${APP_API_ENDPOINT}/insert/getstarted/profile`,
      type: 'POST',
      dataType: 'json',
      xhrFields: { withCredentials: true },
      data: $(this).serialize(), // âœ… SEND ALL FORM DATA
      success(res) {
        if (!res.status || res.status.toLowerCase() !== 'success') {
          iziToast.error({
            title: 'Error',
            message: res.message || 'Invalid token.',
            position: 'topRight'
          });
          $btn.prop('disabled', false).text('Save Profile');
          return;
        }

        iziToast.success({
          title: 'Success',
          message: res.message,
          position: 'topRight',
          timeout: 2000,
          onClosed() {
            window.location.href = '/getstarted/completed';
          }
        });
        $btn.prop('disabled', false).text('Save Profile');
      },
      error(xhr) {
        // Parse JSON from server response
        let errorMsg = 'Server error.';
        try {
          const resJson = JSON.parse(xhr.responseText);
          errorMsg = resJson.message || errorMsg;
        } catch (e) {
          console.error('Failed to parse JSON:', e);
        }

        iziToast.error({
          title: 'Error',
          message: errorMsg,
          position: 'topRight'
        });
        $btn.prop('disabled', false).text('Save Profile');
      }



    });
  });

});
</script>




<!-- SUBMIT -->





<!-- N/A checkbox ==================================== -->
        <script>
            $(document).ready(function() {
                // Auto-format contact number
                $('#pd_contact_no').on('input', function() {
                    let value = $(this).val();
                    // Remove non-digit characters
                    value = value.replace(/\D/g, '').substring(0, 11); // limit to 11 just in case
                    // Format as 0900-000-0000
                    if(value.length > 4 && value.length <= 7){
                        value = value.slice(0,4) + '-' + value.slice(4);
                    } else if(value.length > 7){
                        value = value.slice(0,4) + '-' + value.slice(4,7) + '-' + value.slice(7,12);
                    }
                    $(this).val(value);
                });

                // Handle N/A checkbox
                $('#na_contact').change(function() {
                    if($(this).is(':checked')) {
                        $('#pd_contact_no').val('N/A').prop('disabled', true);
                    } else {
                        $('#pd_contact_no').val('').prop('disabled', false);
                    }
                });
                $('#na_suffix').change(function() {
                    if($(this).is(':checked')) {
                        $('#pd_suffix').val('N/A').prop('disabled', true);
                    } else {
                        $('#pd_suffix').val('').prop('disabled', false);
                    }
                });
            });
        </script>
<!-- N/A checkbox ==================================== -->


<!-- PROFILE DETAILS ====================================== -->
<script>
  $(document).ready(function () {
    const dataS = $('#pd_address_town, #pd_address_brgy, #pd_birth_year, #pd_birth_month, #pd_birth_day');
    dataS.select2({
        placeholder: "-- SELECT DEPARTMENT --",
        theme: 'bootstrap-5',
        allowClear: true,
        width: '100%'               // make it full width
    });


  // Apply Bootstrap look to Select2
  dataS.on('select2:open select2:select', function () {
    $(this)
      .next('.select2-container')
      .find('.select2-selection--single')
      .addClass('form-select fw-bold text-uppercase');
  });


    // Populate year dropdown
    let currentYear = new Date().getFullYear();
    for (let y = currentYear; y >= 1900; y--) {
        $('#pd_birth_year').append('<option value="'+y+'">'+y+'</option>');
    }

    // Populate days
    function daysInMonth(month, year) {
        return new Date(year, month, 0).getDate();
    }

    function populateDays() {
        let month = parseInt($('#pd_birth_month').val());
        let year = parseInt($('#pd_birth_year').val());
        if (!month || !year) return;

        let daySelect = $('#pd_birth_day');
        daySelect.empty();
        daySelect.append('<option value="" disabled selected>Day</option>');
        for (let d = 1; d <= daysInMonth(month, year); d++) {
            daySelect.append('<option value="'+d+'">'+d+'</option>');
        }
    }

    $('#pd_birth_month, #pd_birth_year').on('change', populateDays);

    // Fetch towns
    function fetchTowns() {
        let currentTown = $('#pd_address_town').val();
        $.ajax({
            url: `${APP_API_ENDPOINT}/getdata/address/select_town`,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ town: '' }),
            success: function(rows) {
                let options = '<option value="">Select Town</option>';
                rows.forEach(row => {
                    options += `<option value="${row.dt_town}" ${row.dt_town === currentTown ? 'selected' : ''}>${row.dt_town}</option>`;
                });
                $('#pd_address_town').html(options).trigger('change'); // refresh Select2
            }
        });
    }
    fetchTowns();

    // Fetch barangays
    function fetchBarangays(town) {
        let currentBrgy = $('#pd_address_brgy').val();
        $.ajax({
            url: `${APP_API_ENDPOINT}/getdata/address/select_brgy`,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ town: town, brgy: '' }),
            success: function(rows) {
                let options = '<option value="">Select Barangay</option>';
                rows.forEach(row => {
                    options += `<option value="${row.dt_brgy}" ${row.dt_brgy === currentBrgy ? 'selected' : ''}>${row.dt_brgy}</option>`;
                });
                $('#pd_address_brgy').html(options).trigger('change'); // refresh Select2
            }
        });
    }

    $('#pd_address_town').on('change', function() {
        let selectedTown = $(this).val();
        if (selectedTown) {
            $('#pd_address_brgy').prop('disabled', false);
            fetchBarangays(selectedTown);
        } else {
            $('#pd_address_brgy').prop('disabled', true).html('<option value="">Select Barangay</option>').trigger('change');
        }
    });
});

</script>
<!-- PROFILE DETAILS ====================================== -->


<script>
$(document).ready(function () {

  const $departmentSelect = $('#pd_office_department_name');

  /* ===========================
     SELECT2 INIT (MODAL SAFE)
  ============================ */
  $departmentSelect.select2({
    placeholder: "-- SELECT DEPARTMENT --",
    theme: 'bootstrap-5',
    width: '100%',
  });

  // Apply Bootstrap look to Select2
  $departmentSelect.on('select2:open select2:select', function () {
    $(this)
      .next('.select2-container')
      .find('.select2-selection--single')
      .addClass('form-select fw-bold text-uppercase');
  });

  /* ===========================
     FETCH DEPARTMENTS
  ============================ */
  $.ajax({
    url: `${APP_API_ENDPOINT}/getdata/office/department`,
    type: 'GET',
    dataType: 'json',
    xhrFields: { withCredentials: true },
    success(response) {

      if (response.status !== 'success') {
        alert('Failed to fetch departments');
        return;
      }

      response.data.forEach(dept => {
        $departmentSelect.append(
          new Option(
            `${dept.office_id} - ${dept.office_name} - ${dept.office_acronym}`,
            `${dept.office_id} / ${dept.office_name} / ${dept.office_acronym}`
          )
        );
      });
    },
    error(xhr, status, error) {
      console.error('AJAX Error:', error);
      alert('Error fetching department data');
    }
  });
});
</script>




















  <script>
    $(document).ready(function() {
      $('#revokeBtn').on('click', function(e) {
        e.preventDefault();
        const $btn = $(this);
        $btn.prop('disabled', true).text('Revoking...');
        if (typeof APP_API_ENDPOINT === 'undefined') {
          $btn.prop('disabled', false).text('Back to sign-in');
          return;
        }
        $.ajax({
          url: `${APP_API_ENDPOINT}/revoke/google`,
          method: 'POST',
          dataType: 'json',
          xhrFields: { withCredentials: true },
          success: function(res) {
            if (res.status === 'success') {
              window.location.href = '/sign-in';
            } else {
              $btn.prop('disabled', false).text('Back to sign-in');
            }
          },
          error: function(err) {
            console.error(err);
            alert('An error occurred while revoking access.');
            $btn.prop('disabled', false).text('Back to sign-in');
          }
        });
      });
    });
  </script>

</body>
</html>
