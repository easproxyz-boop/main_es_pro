<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Getstarted - Completed</title>

  <!-- ===========================
       STYLESHEETS
  ============================ -->
  <link rel="shortcut icon" href="assets/images/logo/provincial-capitol-logo.png" type="image/x-icon">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables Bootstrap 5 CSS -->
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">

  <!-- Remix Icon CSS -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- iziToast CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css" />

  <!-- Animate.css for animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Toastr CSS (Optional alternative to iziToast) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

  <!-- ===========================
       JAVASCRIPTS
  ============================ -->

  <!-- jQuery (must be loaded first) -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- DataTables Core -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <!-- DataTables Bootstrap 5 integration -->
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- iziToast JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>

  <!-- Toastr JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

  <!-- Lottie Animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.1/lottie.min.js"></script>



  <!-- CUSTOMIZE -->
  <!-- Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>


  <script src="../js/app_api/app_api_endpoint.js" defer></script>
  <script src="../js/main/googleAuthAccess/googleAuthAccess.js" defer></script>

</head>
<body>

  <nav class="sticky-top bg-dark border border-bottom border-1 p-3">
    <a id="revokeBtn" class="btn btn-danger btn-sm">
      <i class="ri-arrow-left-fill"></i>
      Back to sign-in
    </a>
  </nav>




  <main class="py-5 container">


  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <!-- STEP 1 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-primary px-3 py-2">1</span>
        <div class="small fw-semibold mt-1">Token</div>
      </div>
      <div class="flex-fill border-top border-2 border-primary mx-1"></div>
      <!-- STEP 2 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-primary px-3 py-2">2</span>
        <div class="small fw-semibold mt-1">Provide Profile Details</div>
      </div>
      <div class="flex-fill border-top border-2 border-primary mx-1"></div>
      <!-- STEP 3 -->
      <div class="text-center flex-fill">
        <span class="badge rounded-pill bg-primary px-3 py-2">3</span>
        <div class="small fw-semibold mt-1">Completed</div>
      </div>
    </div>
  </div>



    <div class="card mt-5">
        <div class="card-header">
            <h3 class="fs-3">Completed</h3>
        </div>
        <div class="card-body">

          <form id="formCompletedX">

            <!-- GOOGLE USER CARD -->
            <div class="card bg-dark bg-opacity-10 mb-4 border-0 google-card">
              <div class="card-body d-flex align-items-center gap-3">
                <img
                  src="/default-avatar.png"
                  alt="Google Profile"
                  class="user-picture google-avatar rounded-circle border border-2"
                  width="55"
                  height="55"
                >
                <div class="flex-grow-1">
                  <div class="fw-bold user-name fs-6 text-dark">Guest User</div>
                  <div class="text-muted small user-email">email@gmail.com</div>
                  <span class="badge bg-light text-secondary mt-1 user-id">
                    Google ID
                  </span>
                </div>
                <div class="text-end">
                  <i class="ri-google-fill text-danger fs-3"></i>
                </div>
              </div>
            </div>

            <hr class="mb-2">


            <div class="d-flex justify-content-center align-items-center">
              <i class="ri-mail-check-fill text-muted" style="font-size: 6rem;"></i>
            </div>

            <h3 class="text-center fw-semibold text-muted">
              You're all done! Every step has been completed successfully.<br>
              Your information is safe, processed, and fully updated in the system.
            </h3>

            <div class="d-flex justify-content-center align-items-center">

            <button type="submit" id="btn-getstarted-3-completed" class="btn btn-dark w-50 mt-4 mb-4 fs-5">
              Continue
            </button>

            </div>


          </form>





        </div>
    </div>
  </main>


<script>
$(document).ready(function () {
  $('#formCompletedX').on('submit', function (e) {
    e.preventDefault();

    const $btn = $('#btn-getstarted-3-completed');
    $btn.prop('disabled', true).text('Proccessing...');
    const completedId = '1';
    $.ajax({
      url: `${APP_API_ENDPOINT}/insert/getstarted/completed`,
      type: 'POST',
      dataType: 'json',
      xhrFields: { withCredentials: true },
      data: { completed_id: completedId},
      success(res) {
        if (!res.status || res.status.toLowerCase() !== 'success') {
          iziToast.error({
            title: 'Error',
            message: res.message || 'Invalid.',
            position: 'topRight'
          });
          $btn.prop('disabled', false).text('Continue');
          return;
        }

        iziToast.success({
          title: 'Success',
          message: res.message,
          position: 'topRight',
          timeout: 2000,
          onClosed() {
            window.location.href = '/main';
          }
        });
        $btn.prop('disabled', false).text('Continue');
      },
      error(xhr) {
        // Parse JSON from server response
        let errorMsg = 'Server error.';
        try {
          const resJson = JSON.parse(xhr.responseText);
          errorMsg = resJson.message || errorMsg;
        } catch (e) {
          console.error('Failed to parse JSON:', e);
        }

        iziToast.error({
          title: 'Error',
          message: errorMsg,
          position: 'topRight'
        });
        $btn.prop('disabled', false).text('Continue');
      }



    });
  });

});
</script>














  <script>
    $(document).ready(function() {
      $('#revokeBtn').on('click', function(e) {
        e.preventDefault();
        const $btn = $(this);
        $btn.prop('disabled', true).text('Revoking...');
        if (typeof APP_API_ENDPOINT === 'undefined') {
          $btn.prop('disabled', false).text('Back to sign-in');
          return;
        }
        $.ajax({
          url: `${APP_API_ENDPOINT}/revoke/google`,
          method: 'POST',
          dataType: 'json',
          xhrFields: { withCredentials: true },
          success: function(res) {
            if (res.status === 'success') {
              window.location.href = '/sign-in';
            } else {
              $btn.prop('disabled', false).text('Back to sign-in');
            }
          },
          error: function(err) {
            console.error(err);
            alert('An error occurred while revoking access.');
            $btn.prop('disabled', false).text('Back to sign-in');
          }
        });
      });
    });
  </script>

</body>
</html>
